# 작업 계획서: 이미지별 팔레트 추출 파라미터 저장/로드

**작업 일시**: 2026-01-07 11:55  
**작업 목표**: 각 이미지 파일마다 팔레트 추출 시 사용한 파라미터를 별도 설정 파일로 저장하고, 이미지 로드 시 자동으로 불러오기

## 작업 배경
- 현재 팔레트 추출 시 사용하는 파라미터들(위치, 배율, 팔레트 설정, 이미지 조정 등)이 이미지마다 다를 수 있음
- 같은 이미지를 다시 작업할 때 이전 설정을 기억하지 못해 불편함
- 각 이미지별로 최적의 설정을 저장하여 재사용 가능하도록 개선 필요

## 저장할 파라미터 목록

### 팔레트 설정
- `palette_method`: 팔레트 변환 방법 ('nearest', 'quantize', 'dither')
- `use_palette`: 팔레트 적용 여부 (True/False)

### 위치/배율 설정
- `crop_scale`: 크롭 배율 (기본값: 2.0)
- `center_offset_x`: 중심 X 오프셋 (기본값: 0)
- `center_offset_y`: 중심 Y 오프셋 (기본값: 0)

### 이미지 조정 설정
- `brightness`: 밝기 (기본값: 1.0)
- `contrast`: 대비 (기본값: 1.0)
- `saturation`: 채도 (기본값: 1.0)
- `color_temp`: 색온도 (기본값: 0.0)
- `hue`: 색조 (기본값: 0.0)
- `sharpness`: 선명도 (기본값: 1.0)
- `exposure`: 노출 (기본값: 1.0)
- `equalize`: 평탄화 (기본값: 0.0)
- `gamma`: 감마 보정 (기본값: 1.0)
- `vibrance`: 비브런스 (기본값: 1.0)
- `clarity`: 명확도 (기본값: 0.0)
- `dehaze`: 안개 제거 (기본값: 0.0)
- `tint`: 틴트 (기본값: 0.0)
- `noise_reduction`: 노이즈 제거 (기본값: 0.0)
- `vignette`: 비네팅 (기본값: 0.0)

## 작업 순서

### 1단계: utils/config.py에 이미지별 설정 저장/로드 함수 추가
- [x] `load_face_extract_params(image_path)` 함수 추가
  - 원본 이미지 경로를 기반으로 설정 파일 경로 생성: `원본파일명.s7ed.json`
  - 설정 파일이 존재하면 JSON으로 읽어서 딕셔너리 반환
  - 설정 파일이 없으면 None 반환
  - 예외 발생 시 로그 출력 후 None 반환

- [x] `save_face_extract_params(image_path, params)` 함수 추가
  - 원본 이미지 경로를 기반으로 설정 파일 경로 생성: `원본파일명.s7ed.json`
  - params 딕셔너리를 JSON으로 저장
  - 예외 발생 시 로그 출력

### 2단계: gui/_face_extract.py에 파라미터 저장/로드 메서드 추가
- [x] `_load_image_params(self, image_path)` 메서드 추가
  - `utils.config.load_face_extract_params(image_path)` 호출
  - 설정이 있으면 모든 tk.DoubleVar, tk.IntVar, tk.StringVar, tk.BooleanVar 값 설정
  - 설정 로드 후 UI 업데이트 (슬라이더 라벨 등)

- [x] `_save_image_params(self, image_path)` 메서드 추가
  - 현재 모든 파라미터 값을 딕셔너리로 수집
  - `utils.config.save_face_extract_params(image_path, params)` 호출

### 3단계: gui/_face_extract.py의 load_image() 수정
- [x] `load_image()` 함수에서 이미지 로드 후 설정 파일 읽어오기
  - 이미지 경로 저장 후 `_load_image_params()` 호출
  - 설정 로드 후 `extract_face()` 호출하여 적용된 설정으로 얼굴 추출

### 4단계: gui/_face_extract.py의 save_png() 수정
- [x] `save_png()` 함수에서 PNG 저장 후 설정 파일 저장하기
  - PNG 저장 성공 후 `_save_image_params()` 호출
  - 원본 이미지 경로(`self.current_image_path`)를 사용하여 설정 저장

### 5단계: 테스트 및 검증
- [ ] 이미지 로드 시 설정 파일 자동 읽기 테스트
- [ ] PNG 저장 시 설정 파일 자동 저장 테스트
- [ ] 설정 파일이 없을 때 기본값 사용 확인
- [ ] 설정 파일 형식 검증 (JSON 파싱 오류 처리)

## 기술 스택
- Python
- JSON (설정 파일 저장/로드)
- tkinter (GUI 변수 관리)

## 구현 세부사항

### 설정 파일 형식
```json
{
  "palette_method": "nearest",
  "use_palette": true,
  "crop_scale": 2.0,
  "center_offset_x": 0,
  "center_offset_y": 0,
  "brightness": 1.0,
  "contrast": 1.0,
  "saturation": 1.0,
  "color_temp": 0.0,
  "hue": 0.0,
  "sharpness": 1.0,
  "exposure": 1.0,
  "equalize": 0.0,
  "gamma": 1.0,
  "vibrance": 1.0,
  "clarity": 0.0,
  "dehaze": 0.0,
  "tint": 0.0,
  "noise_reduction": 0.0,
  "vignette": 0.0
}
```

### 파일명 규칙
- 원본 이미지: `image001.jpg`
- 설정 파일: `image001.jpg.s7ed.json`
- 같은 디렉토리에 저장

### 예외 처리
- 설정 파일 읽기 실패 시: 기본값 사용, 로그 출력
- 설정 파일 저장 실패 시: 로그 출력 (PNG 저장은 성공했으므로 계속 진행)
- JSON 파싱 오류 시: 기본값 사용, 로그 출력

