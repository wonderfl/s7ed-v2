# 슬라이더 변경 시 성능 최적화 (드래그 종료 시에만 적용)

**작성 일시**: 2026-01-20 01:05  
**작업 목적**: 슬라이더 드래그 중에는 이미지 변형을 적용하지 않고, 드래그 종료 시에만 적용하도록 수정하여 성능 개선

## 문제 분석

### 현재 문제점

**문제**: 일부 슬라이더에서 드래그 중에도 `morph_face_by_polygons`가 호출되어 버벅거림

**현재 동작**:
1. `slider_ui.py`: 드래그 중에는 라벨만 업데이트, 드래그 종료 시에만 적용 (올바름)
2. `__init__.py`, `morphing/ui.py`: 슬라이더의 `command`에 `on_morphing_change` 직접 연결 (문제)
   - 드래그 중에도 계속 호출되어 버벅거림

**영향**:
- 드래그 중에도 매번 `morph_face_by_polygons` 호출
- 큰 이미지에서 성능 저하
- 실시간 반응성 떨어짐

## 작업 계획

### 1. `__init__.py`의 슬라이더 수정

**위치**: `gui/face_edit/__init__.py` (648줄 `create_slider` 함수)

**변경 내용**:
- 슬라이더의 `command` 파라미터를 라벨만 업데이트하는 함수로 변경
- `<ButtonRelease-1>` 이벤트에 `on_morphing_change` 연결

**구현**:
```python
def create_slider(parent, label_text, variable, from_val, to_val, resolution, default_label="", width=6, default_value=1.0):
    frame = tk.Frame(parent)
    frame.pack(fill=tk.X, pady=(0, 5))
    
    title_label = tk.Label(frame, text=label_text, width=label_width, anchor="e", cursor="hand2")
    title_label.pack(side=tk.LEFT, padx=(0, 5))
    
    value_label = tk.Label(frame, text=default_label, width=width)
    value_label.pack(side=tk.LEFT)
    
    def on_slider_change(value):
        # 드래그 중에는 라벨만 업데이트
        if hasattr(self, 'update_labels_only'):
            self.update_labels_only()
        else:
            # update_labels_only가 없으면 라벨만 직접 업데이트
            value_label.config(text=f"{int(float(value) * 100)}%")
    
    def on_slider_release(event):
        # 드래그 종료 시 실제 편집 적용
        self.on_morphing_change()
    
    def reset_slider(event):
        variable.set(default_value)
        self.on_morphing_change()
    
    title_label.bind("<Button-1>", reset_slider)
    
    scale = tk.Scale(
        frame,
        from_=from_val,
        to=to_val,
        resolution=resolution,
        orient=tk.HORIZONTAL,
        variable=variable,
        command=on_slider_change,  # 드래그 중에는 라벨만 업데이트
        length=scaled_length,
        showvalue=False
    )
    scale.pack(side=tk.LEFT, padx=(0, 5))
    scale.bind("<ButtonRelease-1>", on_slider_release)  # 드래그 종료 시 적용
    
    return value_label
```

### 2. `morphing/ui.py`의 슬라이더 수정

**위치**: `gui/face_edit/morphing/ui.py` (132줄 근처)

**변경 내용**:
- 슬라이더의 `command` 파라미터를 라벨만 업데이트하는 함수로 변경
- `<ButtonRelease-1>` 이벤트에 `on_morphing_change` 연결

## 예상 효과

### 성능 향상

**이전**:
- 드래그 중에도 매번 `morph_face_by_polygons` 호출
- 예: 슬라이더를 1초 동안 드래그하면 수십 번 호출

**개선 후**:
- 드래그 중에는 라벨만 업데이트 (호출 없음)
- 드래그 종료 시에만 1번 호출
- 성능 향상: 드래그 중 호출 제거로 부드러운 조작 가능

### 사용자 경험 향상

- 드래그 중에는 라벨만 업데이트되어 반응성 유지
- 실제 이미지 변형은 드래그 종료 시에만 적용되어 부드러운 조작 가능
- `slider_ui.py`와 동일한 동작으로 일관성 유지

## 작업 단계

- [x] 1. `__init__.py`의 `create_slider` 함수 수정 (드래그 중 라벨만 업데이트, 종료 시 적용) ✅
- [x] 2. `__init__.py`의 눈 탭 슬라이더들 수정 (`create_eye_slider`, `create_eye_position_x_slider`, `create_eye_position_y_slider`) ✅
- [x] 3. `slider_ui.py`의 전체 탭 슬라이더 수정 (`_create_face_tab`의 `create_slider`) ✅
- [x] 4. 테스트 및 검증 (드래그 중 호출 없음 확인) ✅

## 주의사항

1. **기존 동작 유지**: `slider_ui.py`와 동일한 패턴으로 수정
2. **라벨 업데이트**: 드래그 중에도 라벨은 즉시 업데이트하여 반응성 유지
3. **reset_slider**: 라벨 더블클릭 시에는 즉시 적용 (기존 동작 유지)
4. **일관성**: 모든 슬라이더가 동일한 동작을 하도록 통일

## 완료 조건

- [x] 모든 슬라이더가 드래그 중에는 라벨만 업데이트하도록 수정 완료 ✅
- [x] 드래그 종료 시에만 `morph_face_by_polygons` 호출 확인 ✅
- [x] 성능 향상 확인 (드래그 중 호출 없음) ✅
- [x] 사용자 경험 향상 확인 (부드러운 조작) ✅
- [x] 기존 기능 정상 동작 확인 (reset_slider 등) ✅
