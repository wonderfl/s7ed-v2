# 작업 계획서: 눈동자 탭으로 margin_ratio 슬라이더 이동 (task260124_2050)

## 1. 작업 목표

눈동자 이동 범위 제한 설정(margin_ratio)을 **눈 탭**에서 **눈동자 탭**으로 이동하여 사용자가 눈동자 작업 중 바로 설정을 조절할 수 있도록 UI/UX를 개선합니다.

### 최종 결과:
* ✅ 눈동자 탭에 "눈동자 이동 범위 제한" 설정 UI 추가
* ✅ 눈 탭에서 눈동자 관련 설정 제거
* ✅ 문서 업데이트 (UI 위치 정보 수정)
* ✅ 워크플로우 개선: 탭 전환 없이 눈동자 작업 중 설정 조절 가능

## 2. 현재 상태 분석

### 2.1 기존 UI 위치
- **파일**: `gui/face_edit/__init__.py` (라인 735-788)
- **위치**: 눈(Eye) 탭
- **구성**: 
  - "눈동자 이동 범위 제한" LabelFrame
  - 클램핑 활성화 체크박스
  - 마진 비율 슬라이더 (0.0 ~ 1.0)

### 2.2 문제점
1. **워크플로우 비효율**: 눈동자 작업 중 설정을 바꾸려면 눈 탭으로 이동해야 함
2. **기능 응집도 낮음**: 눈동자 관련 기능이 눈 탭에 분산됨
3. **직관성 부족**: 사용자는 눈동자 설정이 눈동자 탭에 있을 것으로 기대

### 2.3 눈동자 탭 현황
- **파일**: `gui/face_edit/slider_ui.py` (라인 1111-1125)
- **현재 상태**: 거의 비어있음 (안내 텍스트만 존재)
- **주석**: "나중에 필요하면 슬라이더 추가 가능"

## 3. 해결 방안 및 상세 계획

### 3.1 눈동자 탭에 UI 추가

**파일**: `gui/face_edit/slider_ui.py`

**위치**: `_create_iris_tab()` 함수 (라인 1111-1125)

**추가 내용**:

```python
def _create_iris_tab(self, notebook):
    """눈동자 탭 UI 생성"""
    tab_frame = tk.Frame(notebook, padx=5, pady=5)
    
    scaled_length = 200
    label_width = 16
    
    # 안내 텍스트
    info_label = tk.Label(
        tab_frame,
        text="눈동자 위치를 드래그하여 조정할 수 있습니다.",
        font=("", 9),
        fg="gray"
    )
    info_label.pack(pady=10)
    
    # ==============================
    # 눈동자 이동 범위 제한 설정
    # ==============================
    iris_clamping_frame = tk.LabelFrame(tab_frame, text="눈동자 이동 범위 제한", padx=5, pady=5)
    iris_clamping_frame.pack(fill=tk.BOTH, expand=False, pady=(10, 0))
    
    # 클램핑 활성화 체크박스
    clamping_checkbox = tk.Checkbutton(
        iris_clamping_frame,
        text="눈동자 이동 범위 제한 활성화",
        variable=self.iris_clamping_enabled,
        command=self.on_morphing_change
    )
    clamping_checkbox.pack(anchor=tk.W, pady=(0, 5))
    
    # 마진 비율 슬라이더 (소수점 표시용)
    def create_margin_ratio_slider(parent, label_text, variable, from_val, to_val, resolution, default_label=""):
        frame = tk.Frame(parent)
        frame.pack(fill=tk.X, pady=(0, 5))
        
        title_label = tk.Label(frame, text=label_text, width=label_width, anchor="e", cursor="hand2")
        title_label.pack(side=tk.LEFT, padx=(0, 4))
        
        value_label = tk.Label(frame, text=default_label, width=6)
        
        def on_slider_change(value):
            value_label.config(text=f"{float(value):.1f}")
        
        def on_slider_release(event):
            self.on_morphing_change()
        
        def reset_slider(event):
            variable.set(0.3)
            value_label.config(text="0.3")
            self.on_morphing_change()
        
        title_label.bind("<Button-1>", reset_slider)
        
        scale = tk.Scale(
            frame,
            from_=from_val,
            to=to_val,
            resolution=resolution,
            orient=tk.HORIZONTAL,
            variable=variable,
            command=on_slider_change,
            length=scaled_length,
            showvalue=False
        )
        scale.pack(side=tk.LEFT, padx=(0, 5))
        scale.bind("<ButtonRelease-1>", on_slider_release)
        
        value_label.pack(side=tk.LEFT)
        
        return value_label
    
    self.iris_clamping_margin_ratio_label = create_margin_ratio_slider(
        iris_clamping_frame,
        "제한 마진 비율:",
        self.iris_clamping_margin_ratio,
        0.0,
        1.0,
        0.01,
        "0.3"
    )
    
    return tab_frame
```

### 3.2 눈 탭에서 UI 제거

**파일**: `gui/face_edit/__init__.py`

**제거할 부분** (라인 735-788):
- "눈동자 이동 범위 제한" LabelFrame 전체 섹션
- 클램핑 활성화 체크박스
- 마진 비율 슬라이더 및 관련 헬퍼 함수

**주의사항**:
- 전역 변수 선언은 유지 (라인 91-92):
  ```python
  self.iris_clamping_enabled = tk.BooleanVar(value=True)
  self.iris_clamping_margin_ratio = tk.DoubleVar(value=0.3)
  ```

### 3.3 문서 업데이트

**파일**: `docs/iris_eyelid_integration.md`

**업데이트 내용**:
1. **UI 위치 정보 수정**:
   - "UI 위치: 눈(Eye) 탭" → "UI 위치: 눈동자(Iris) 탭"
   - 파일 경로: `gui/face_edit/__init__.py` → `gui/face_edit/slider_ui.py`
   - 라인 번호: 738-788 → 1111-1195

2. **탭 간 설정 공유 설명 수정**:
   - "눈 탭에서 설정" → "눈동자 탭에서 설정"
   - 모든 관련 설명 업데이트

3. **사용 예시 섹션 업데이트**:
   - 조절 방법: "눈 탭으로 이동" → "눈동자 탭으로 이동 (또는 눈동자 작업 중 같은 탭에서)"

## 4. 구현 순서

### 4.1 1단계: 눈동자 탭에 UI 추가
- [x] `gui/face_edit/slider_ui.py`의 `_create_iris_tab()` 함수 전체 교체
- [x] 눈 탭의 코드를 복사하여 적용
- [x] 슬라이더 생성 로직 포함 (소수점 표시 지원)

### 4.2 2단계: 눈 탭에서 UI 제거
- [x] `gui/face_edit/__init__.py`에서 "눈동자 이동 범위 제한" 섹션 삭제 (라인 735-788)
- [x] 변수 선언은 유지 (라인 91-92)

### 4.3 3단계: 문서 업데이트
- [x] `docs/iris_eyelid_integration.md` UI 위치 정보 수정
- [x] 탭 간 설정 공유 설명 업데이트
- [x] 사용 예시 섹션 업데이트

## 5. 예상 효과

### 5.1 워크플로우 개선
✅ **탭 전환 불필요**: 눈동자 작업 중 같은 탭에서 바로 설정 조절 가능

**개선 전**:
```
1. 눈동자 탭에서 눈동자 드래그
2. 눈 탭으로 이동
3. 마진 비율 조절
4. 눈동자 탭으로 복귀
5. 결과 확인
```

**개선 후**:
```
1. 눈동자 탭에서 눈동자 드래그
2. 같은 탭에서 마진 비율 조절
3. 즉시 결과 확인
```

### 5.2 직관성 향상
✅ **기능 응집도**: 눈동자 관련 모든 기능이 눈동자 탭에 집중
- 눈동자 위치 드래그
- 눈동자 이동 범위 제한
- 마진 비율 조절

### 5.3 UI 밀도 분산
✅ **눈 탭 복잡도 감소**: 눈 전체 관련 설정만 남음
✅ **눈동자 탭 활용도 증가**: 거의 비어있던 탭이 유용하게 활용됨

### 5.4 각 탭 역할 명확화
- **눈 탭**: 눈 전체 (크기, 위치, 간격)
- **눈동자 탭**: 눈동자 (위치, 이동 범위)

## 6. 주의사항

### 6.1 전역 변수 공유
- `self.iris_clamping_enabled` (BooleanVar)
- `self.iris_clamping_margin_ratio` (DoubleVar)
- 모든 탭에서 동일한 변수를 참조하므로 기능은 동일하게 작동

### 6.2 슬라이더 동작
- 드래그 중: 라벨만 업데이트 (성능 최적화)
- 드래그 종료: `self.on_morphing_change()` 호출로 실제 적용
- 라벨 클릭: 기본값(0.3)으로 초기화

### 6.3 코드 재사용
- 눈 탭의 슬라이더 생성 로직을 그대로 복사
- 소수점 표시 지원 (`f"{float(value):.1f}"`)

## 7. 테스트 계획

### 7.1 기능 테스트
1. **눈동자 탭 UI 확인**
   - 눈동자 탭에 "눈동자 이동 범위 제한" 섹션 표시 확인
   - 체크박스 및 슬라이더 정상 동작 확인

2. **설정 적용 확인**
   - 슬라이더 조절 시 눈동자 이동 범위 변경 확인
   - 체크박스 ON/OFF 시 클램핑 활성화/비활성화 확인

3. **탭 간 설정 공유 확인**
   - 눈동자 탭에서 설정 변경 → 전체 탭에서 동일하게 적용 확인

### 7.2 회귀 테스트
1. **눈 탭 확인**
   - 눈동자 설정이 제거되었는지 확인
   - 다른 눈 관련 설정들은 정상 작동하는지 확인

2. **기존 기능 확인**
   - 눈동자 드래그 기능 정상 작동 확인
   - 클램핑 기능 정상 작동 확인

## 8. 변경된 파일 목록

### 8.1 수정된 파일
1. **gui/face_edit/slider_ui.py**
   - `_create_iris_tab()` 함수 전체 교체
   - 눈동자 이동 범위 제한 UI 추가

2. **gui/face_edit/__init__.py**
   - 라인 735-788 삭제 (눈동자 이동 범위 제한 섹션)
   - 변수 선언은 유지 (라인 91-92)

3. **docs/iris_eyelid_integration.md**
   - UI 위치 정보 업데이트
   - 탭 간 설정 공유 설명 업데이트
   - 사용 예시 섹션 업데이트

### 8.2 영향받지 않는 파일
- `utils/face_morphing/polygon_morphing/core.py` (클램핑 로직)
- `gui/face_edit/polygon_renderer/all_tab_drawer.py` (렌더링)
- 기타 모핑 관련 파일들

## 9. 관련 문서

- **기술 문서**: `docs/iris_eyelid_integration.md` - 눈동자 윤곽과 눈꺼풀 랜드마크 연동 시스템
- **이전 작업**: `specs/task260123_1954.md` - 눈동자 이동 방식 개선

## 10. 다음 진행 방식

이 작업은 완료되었습니다. 모든 체크리스트 항목이 완료되었으며, 변경사항이 적용되었습니다.

---

**작성일**: 2026-01-24  
**작성 시간**: 20:50  
**상태**: 완료  
**작성자**: AI Assistant
