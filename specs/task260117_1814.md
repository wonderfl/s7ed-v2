# 작업계획서: 에러 처리/로깅 시스템 개선, README 문서화, 설정 관리 시스템 개선

**작업 일시**: 2026-01-17 18:14  
**작업 목표**: 
1. 통합 로깅 시스템 구축 및 에러 처리 개선
2. README 문서화 개선
3. 설정 관리 시스템 확장 및 개선

## 작업 배경

### 현재 상태
- **에러 처리**: 각 모듈에서 `print(f"[모듈] ...")` 형식으로 개별 처리
- **로깅**: 통합 로깅 시스템 없음, 로그 레벨 관리 없음
- **README**: 매우 간단한 내용만 존재
- **설정 관리**: 기본적인 파일 경로 저장만 지원, UI 없음

### 문제점
1. 에러 추적이 어려움 (로그 형식 불일치, 파일 저장 없음)
2. 신규 사용자가 프로젝트 이해 어려움
3. 사용자 설정 관리가 제한적 (윈도우 위치, 최근 파일 등 미지원)

## 작업 범위

### 작업 1: 에러 처리 및 로깅 시스템 개선

#### 1-1. 통합 로깅 모듈 생성
- **파일**: `utils/logger.py` (신규 생성)
- **기능**:
  - 로그 레벨 관리 (DEBUG, INFO, WARNING, ERROR, CRITICAL)
  - 모듈별 로거 생성
  - 콘솔 출력 및 파일 저장 옵션
  - 로그 포맷 통일 (`[시간] [레벨] [모듈] 메시지`)
  - 기존 `print(f"[모듈] ...")` 형식과 호환되는 래퍼 함수 제공

#### 1-2. 기존 코드에 로거 적용
- **대상 파일**:
  - `utils/config.py`
  - `utils/face_landmarks.py`
  - `gui/face_extract/__init__.py`
  - `gui/face_edit/polygon_renderer.py`
  - 기타 예외 처리하는 모든 파일
- **작업 내용**:
  - `print(f"[모듈] ...")` 형식을 로거 호출로 변경
  - 예외 처리 시 로거 사용
  - 작업룰 8번 준수 (pass 금지, 모든 예외 로그 출력)

#### 1-3. 로그 설정 관리
- **파일**: `config.json`에 로그 설정 추가
- **설정 항목**:
  - 로그 레벨 (기본: INFO)
  - 파일 로그 저장 여부 (기본: False)
  - 로그 파일 경로 (기본: `logs/s7ed.log`)
  - 로그 파일 최대 크기 및 로테이션

### 작업 2: README 문서화 개선

#### 2-1. README 기본 구조 작성
- **파일**: `README.md` (기존 파일 수정)
- **섹션 구성**:
  1. 프로젝트 소개
  2. 주요 기능
  3. 설치 방법
  4. 사용 방법
  5. 단축키 목록
  6. 문제 해결 가이드
  7. 기여 방법 (선택)

#### 2-2. 설치 방법 상세화
- Python 버전 요구사항
- 필수 패키지 설치 방법
- 선택적 패키지 설명 (opencv-python, mediapipe 등)
- GPU 가속 사용 시 추가 설정 (선택)

#### 2-3. 사용 방법 가이드
- 기본 워크플로우
- 주요 기능 설명 (얼굴 편집, 얼굴 추출, 얼굴 생성 등)
- 설정 파일 설명
- 저장 파일 형식 설명

#### 2-4. 단축키 목록 정리
- 현재 구현된 단축키 (Ctrl+F 등)
- 메뉴 구조 설명

### 작업 3: 설정 관리 시스템 개선

#### 3-1. 설정 구조 확장
- **파일**: `utils/config.py` 수정
- **추가 설정 항목**:
  - 윈도우 위치 및 크기 저장
  - 최근 파일 목록 (최대 10개)
  - 기본 디렉토리 경로들
  - UI 설정 (폰트 크기, 테마 등)
  - 로그 설정 (작업 1-3과 연동)

#### 3-2. 설정 저장/로드 개선
- 설정 변경 시 자동 저장
- 설정 검증 로직 추가
- 기본값 관리 개선
- 설정 마이그레이션 (기존 설정 호환성 유지)

#### 3-3. 설정 UI 추가 (선택)
- **파일**: `gui/_settings.py` (신규 생성, 선택적)
- **기능**:
  - 설정 메뉴 항목 추가
  - 설정 대화상자 UI
  - 경로 선택 다이얼로그
  - 설정 초기화 옵션
- **우선순위**: 낮음 (필요 시 추가)

## 작업 단계

### Phase 1: 로깅 시스템 구축 (우선순위: 높음)

- [x] 1-1. 통합 로깅 모듈 생성 (`utils/logger.py`)
  - [x] 1-1-1. 로거 클래스/함수 구현
  - [x] 1-1-2. 로그 레벨 관리
  - [x] 1-1-3. 파일 로그 저장 기능
  - [x] 1-1-4. 기존 형식 호환 래퍼 함수
- [x] 1-2. 기존 코드에 로거 적용
  - [x] 1-2-1. `utils/config.py` 적용
  - [x] 1-2-2. `utils/face_landmarks.py` 적용
  - [x] 1-2-3. `gui/face_extract/__init__.py` 적용
  - [x] 1-2-4. `gui/face_edit/polygon_renderer.py` 적용
  - [x] 1-2-5. 기타 예외 처리 파일들 적용
- [x] 1-3. 로그 설정 관리
  - [x] 1-3-1. `config.json`에 로그 설정 추가
  - [x] 1-3-2. 로그 설정 로드/저장 기능
  - [x] 1-3-3. 로그 디렉토리 자동 생성

### Phase 2: README 문서화 (우선순위: 중간)

- [x] 2-1. README 기본 구조 작성
  - [x] 2-1-1. 프로젝트 소개 섹션
  - [x] 2-1-2. 주요 기능 섹션
  - [x] 2-1-3. 기본 구조 완성
- [x] 2-2. 설치 방법 상세화
  - [x] 2-2-1. 요구사항 명시
  - [x] 2-2-2. 설치 절차 작성
  - [x] 2-2-3. 선택적 패키지 설명
- [x] 2-3. 사용 방법 가이드
  - [x] 2-3-1. 기본 워크플로우 설명
  - [x] 2-3-2. 주요 기능 설명
  - [x] 2-3-3. 설정 파일 설명
- [x] 2-4. 단축키 및 기타 정보
  - [x] 2-4-1. 단축키 목록 정리
  - [x] 2-4-2. 문제 해결 가이드
  - [x] 2-4-3. 기타 유용한 정보

### Phase 3: 설정 관리 시스템 개선 (우선순위: 중간)

- [x] 3-1. 설정 구조 확장
  - [x] 3-1-1. 새로운 설정 항목 추가 (윈도우 위치, 최근 파일 등)
  - [x] 3-1-2. 설정 스키마 정의
  - [x] 3-1-3. 기본값 관리
- [x] 3-2. 설정 저장/로드 개선
  - [x] 3-2-1. 자동 저장 기능
  - [x] 3-2-2. 설정 검증 로직
  - [x] 3-2-3. 설정 마이그레이션 (기존 호환성)
- [ ] 3-3. 설정 UI 추가 (선택적, 낮은 우선순위)
  - [ ] 3-3-1. 설정 대화상자 UI 설계
  - [ ] 3-3-2. 설정 UI 구현
  - [ ] 3-3-3. 메뉴에 설정 항목 추가

## 구현 세부사항

### 1. 로깅 모듈 구조 (`utils/logger.py`)

```python
"""
통합 로깅 시스템
모든 모듈에서 사용할 수 있는 통합 로거 제공
"""
import logging
import os
from datetime import datetime
from pathlib import Path

# 로그 레벨
LOG_LEVELS = {
    'DEBUG': logging.DEBUG,
    'INFO': logging.INFO,
    'WARNING': logging.WARNING,
    'ERROR': logging.ERROR,
    'CRITICAL': logging.CRITICAL
}

def get_logger(module_name):
    """모듈별 로거 반환"""
    # 로거 생성 및 설정
    # 콘솔 핸들러 및 파일 핸들러 추가
    pass

def log_error(module_name, message, exception=None):
    """에러 로깅 헬퍼 함수"""
    # 기존 print(f"[모듈] ...") 형식과 호환
    pass
```

### 2. README 구조

```markdown
# 삼국지 VII 에디터 (s7ed-v2)

## 프로젝트 소개
...

## 주요 기능
- 장수 데이터 편집
- 얼굴 편집/추출/생성
- 게임 저장 파일 관리
...

## 설치 방법
### 요구사항
- Python 3.x
...

## 사용 방법
...

## 단축키
- Ctrl+F: 검색
...

## 문제 해결
...
```

### 3. 설정 구조 확장

```python
# config.json 구조
{
  "loading_file": "...",
  "face_file": "...",
  "window": {
    "x": 100,
    "y": 100,
    "width": 800,
    "height": 600
  },
  "recent_files": [
    "file1.s7",
    "file2.s7"
  ],
  "logging": {
    "level": "INFO",
    "file_enabled": false,
    "file_path": "logs/s7ed.log"
  }
}
```

## 주의사항

1. **기존 코드 호환성**: 기존 `print(f"[모듈] ...")` 형식과 호환되도록 래퍼 함수 제공
2. **설정 마이그레이션**: 기존 `config.json` 파일과 호환성 유지
3. **작업룰 준수**: 
   - 작업룰 8번: 모든 예외는 로그 출력 (pass 금지)
   - 작업룰 6번: 관계없는 코드는 수정하지 않음
4. **점진적 적용**: 모든 파일을 한 번에 수정하지 않고, 단계적으로 적용

## 테스트 방법

### 로깅 시스템 테스트
- 각 로그 레벨 출력 확인
- 파일 로그 저장 확인
- 예외 발생 시 로그 출력 확인

### 설정 시스템 테스트
- 설정 저장/로드 확인
- 기본값 동작 확인
- 기존 설정 파일 호환성 확인

### README 테스트
- 설치 절차 따라하기
- 사용 방법 따라하기

## 예상 효과

1. **에러 추적 개선**: 통합 로깅으로 문제 파악 용이
2. **사용자 경험 향상**: 명확한 문서와 설정 관리
3. **유지보수성 향상**: 체계적인 로깅과 문서화

## 참고사항

- Python logging 모듈: https://docs.python.org/3/library/logging.html
- 기존 작업룰: `docs/_working_rules.md`
- 기존 설정 파일: `utils/config.py`

## 작업 완료 내역

- 2026-01-17 18:14: 통합 로깅 모듈 생성 (`utils/logger.py`)
- 2026-01-17 18:14: 기존 코드에 로거 적용 (`utils/config.py`, `utils/face_landmarks.py`, `gui/face_extract/__init__.py`, `gui/face_edit/polygon_renderer.py`)
- 2026-01-17 18:14: 로그 설정 관리 기능 추가 (`utils/config.py`)
- 2026-01-17 18:14: README 문서화 완료 (프로젝트 소개, 설치 방법, 사용 방법, 단축키, 문제 해결)
- 2026-01-17 18:14: 설정 구조 확장 (윈도우 위치, 최근 파일 목록)
- 2026-01-17 18:14: 설정 저장/로드 개선 (자동 저장, 설정 마이그레이션)
