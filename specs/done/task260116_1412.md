# 작업계획서: 얼굴 폴리곤 수정 성능 최적화

## 작업 목표
폴리곤 수정 시 적용 시간이 오래 걸리는 문제를 해결하기 위해 성능 최적화를 수행합니다.

## 문제 분석
1. **뒤집힌 삼각형 검사**: 최대 30회 반복으로 모든 삼각형을 매번 검사하여 시간 소요
2. **조기 종료 조건**: 개선이 없어도 3회 연속까지 기다려서 불필요한 반복 발생
3. **과도한 로그 출력**: 디버그 로그가 많아 성능에 영향

## 작업 계획

### 1. 뒤집힌 삼각형 검사 반복 횟수 감소
- **현재**: max_iterations = 30
- **변경**: max_iterations = 12 (60% 감소)
- **위치**: `utils/face_morphing.py` 2669줄
- **이유**: 대부분의 경우 10회 이내에 해결되므로 30회는 과도함

### 2. 조기 종료 조건 강화
- **현재**: no_improvement_count >= 3 (3회 연속 개선 없으면 더 강하게 조정)
- **변경**: no_improvement_count >= 2 (2회 연속 개선 없으면 더 강하게 조정)
- **위치**: `utils/face_morphing.py` 2692줄
- **이유**: 더 빠르게 조정하여 반복 횟수 감소

### 3. 로그 출력 최소화
- **제거할 로그**:
  - 반복 중 매번 출력되는 "뒤집힌 삼각형 감지" 메시지 (2695줄)
  - 개선됨 메시지 (2687줄) - iteration > 0일 때만 출력
- **유지할 로그**:
  - 최종 완료 메시지 (2682줄)
  - 경고 메시지 (2760줄, 2743줄)
- **위치**: `utils/face_morphing.py` 2685-2696줄

### 4. 이미지 다운샘플링 유지
- **현재**: max_dimension = 600
- **변경**: 유지 (품질과 성능의 균형 고려)
- **이유**: 600px는 품질과 성능의 적절한 균형점

## 예상 효과
- **반복 횟수**: 최대 30회 → 최대 12회 (60% 감소)
- **조기 종료**: 평균적으로 더 빠른 종료
- **로그 오버헤드**: 감소
- **전체 성능**: 약 50-70% 개선 예상

## 작업 단계
- [x] 1. max_iterations 값 변경 (30 → 12)
- [x] 2. 조기 종료 조건 변경 (3 → 2)
- [x] 3. 불필요한 로그 출력 제거
- [ ] 4. 테스트 및 검증

## 작업 완료 내역
- 2026-01-16 14:12: max_iterations를 30에서 12로 변경
- 2026-01-16 14:12: no_improvement_count >= 3을 >= 2로 변경 (3곳)
- 2026-01-16 14:12: 불필요한 로그 출력 제거 (else 블록 로그 제거, 개선 메시지 조건 추가)

## 주의사항
- 품질 저하 없이 성능만 개선
- 기존 기능 동작 보장
- 에러 처리 유지
