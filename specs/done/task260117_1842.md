# 작업계획서: utils/face_morphing.py 리팩토링

**작업 일시**: 2026-01-17 18:42  
**작업 목표**: 4,505줄의 대용량 파일을 기능별 모듈로 분리하여 유지보수성 향상

## 작업 배경

### 현재 상태
- **파일**: `utils/face_morphing.py`
- **크기**: 4,505줄 (매우 큼)
- **함수 수**: 34개
- **문제점**:
  - 단일 파일이 너무 커서 유지보수 어려움
  - 기능별로 명확히 분리되지 않음
  - 코드 탐색 및 이해가 어려움
  - 협업 시 충돌 가능성 높음

### 사용 현황
다음 파일들이 `face_morphing` 모듈을 사용:
- `gui/face_edit/morphing.py` (주요 사용)
- `gui/face_edit/__init__.py`
- `gui/face_edit/preview.py`
- `gui/face_edit/polygon_drag_handler.py`
- `utils/face_generation.py`
- `utils/face_transform.py`
- 여러 test 파일들

## 파일 구조 분석

### 함수 분류 (34개 함수)

#### 1. 유틸리티 함수 (2개)
- `_sigmoid_blend_mask()`: 시그모이드 블렌딩 마스크
- `_create_blend_mask()`: 블렌딩 마스크 생성

#### 2. 영역 추출 함수 (3개)
- `_get_eye_region()`: 눈 영역 추출
- `_get_mouth_region()`: 입 영역 추출
- `_get_nose_region()`: 코 영역 추출

#### 3. 이미지 조정 함수 (13개)
- `adjust_eye_size()`: 눈 크기 조정
- `adjust_eye_spacing()`: 눈 간격 조정
- `adjust_eye_position()`: 눈 위치 조정
- `adjust_nose_size()`: 코 크기 조정
- `adjust_jaw()`: 턱선 조정
- `adjust_face_size()`: 얼굴 크기 조정
- `adjust_mouth_size()`: 입 크기 조정
- `adjust_upper_lip_size()`: 윗입술 크기 조정
- `adjust_lower_lip_size()`: 아랫입술 크기 조정
- `adjust_upper_lip_shape()`: 윗입술 모양 조정
- `adjust_lower_lip_shape()`: 아랫입술 모양 조정
- `adjust_upper_lip_width()`: 윗입술 너비 조정
- `adjust_lower_lip_width()`: 아랫입술 너비 조정
- `adjust_lip_vertical_move()`: 입술 수직 이동

#### 4. 랜드마크 변형 및 폴리곤 모핑 함수 (14개) - 통합 권장
**랜드마크 변형 함수 (9개)**:
- `transform_landmarks_for_eye_size()`: 눈 크기용 랜드마크 변형
- `transform_landmarks_for_nose_size()`: 코 크기용 랜드마크 변형
- `transform_landmarks_for_jaw()`: 턱선용 랜드마크 변형
- `transform_landmarks_for_face_size()`: 얼굴 크기용 랜드마크 변형
- `transform_landmarks_for_mouth_size()`: 입 크기용 랜드마크 변형
- `transform_landmarks_for_eye_position()`: 눈 위치용 랜드마크 변형
- `transform_landmarks_for_lip_shape()`: 입술 모양용 랜드마크 변형
- `transform_landmarks_for_lip_width()`: 입술 너비용 랜드마크 변형
- `transform_landmarks_for_lip_vertical_move()`: 입술 수직 이동용 랜드마크 변형

**폴리곤 모핑 함수 (3개)**:
- `_get_neighbor_points()`: 인접 포인트 추출
- `_check_triangles_flipped()`: 뒤집힌 삼각형 검사
- `morph_face_by_polygons()`: 폴리곤(랜드마크 포인트) 기반 얼굴 변형

**랜드마크 이동 함수 (2개)**:
- `move_landmark_group()`: 랜드마크 그룹 이동
- `move_landmark_points()`: 랜드마크 포인트 이동

**통합 권장 이유**: 
- 랜드마크는 폴리곤의 꼭짓점이므로 개념적으로 밀접하게 연관됨
- 폴리곤 모핑은 랜드마크 변형의 결과를 사용하므로 하나의 모듈로 통합하는 것이 자연스러움
- 코드 주석에도 "폴리곤(랜드마크 포인트) 기반"이라고 명시되어 있음

#### 7. 통합 함수 (1개)
- `apply_all_adjustments()`: 모든 조정을 한 번에 적용

#### 8. 전역 변수 및 상수
- `_delaunay_cache`: Delaunay Triangulation 캐시
- `_delaunay_cache_max_size`: 캐시 최대 크기
- `_cv2_available`: OpenCV 사용 가능 여부
- `_cv2_cuda_available`: OpenCV CUDA 지원 여부
- `_scipy_available`: scipy 사용 가능 여부
- `_landmarks_available`: 랜드마크 기능 사용 가능 여부

## 리팩토링 계획

### 모듈 분리 구조

```
utils/
  face_morphing/
    __init__.py          # 공개 API 제공 (기존 호환성 유지)
    utils.py             # 유틸리티 함수 (마스크, 블렌딩)
    region_extraction.py # 영역 추출 함수 (눈, 입, 코)
    adjustments.py       # 이미지 조정 함수 (adjust_*)
    polygon_morphing.py  # 랜드마크 변형 및 폴리곤 모핑 함수 (통합)
    integration.py       # 통합 함수 (apply_all_adjustments)
    constants.py         # 상수 및 전역 변수
```

**변경 사항**: 
- `landmark_transform.py`, `polygon_morphing.py`, `landmark_movement.py` → `polygon_morphing.py`로 통합
- 이유: 랜드마크는 폴리곤의 꼭짓점이므로 개념적으로 밀접하게 연관되어 있음
- 폴리곤 모핑은 랜드마크 변형의 결과를 사용하므로 하나의 모듈로 통합하는 것이 자연스러움

### 작업 단계

#### 1단계: 새 모듈 구조 생성
- [ ] `utils/face_morphing/` 디렉토리 생성
- [ ] 각 모듈 파일 생성 (빈 파일)
- [ ] `__init__.py` 생성 (기존 호환성 유지용)

#### 2단계: 상수 및 전역 변수 분리
- [ ] `constants.py` 생성
  - 전역 변수 이동 (`_delaunay_cache`, `_cv2_available` 등)
  - import 문 이동
  - 선택적 import 로직 이동

#### 3단계: 유틸리티 함수 분리
- [ ] `utils.py` 생성
  - `_sigmoid_blend_mask()` 이동
  - `_create_blend_mask()` 이동
  - 필요한 import 추가

#### 4단계: 영역 추출 함수 분리
- [ ] `region_extraction.py` 생성
  - `_get_eye_region()` 이동
  - `_get_mouth_region()` 이동
  - `_get_nose_region()` 이동
  - 필요한 import 추가

#### 5단계: 이미지 조정 함수 분리
- [ ] `adjustments.py` 생성
  - 모든 `adjust_*` 함수 이동 (13개)
  - 필요한 import 추가
  - 의존성 함수 import 추가

#### 6단계: 폴리곤 포인트 변형 및 폴리곤 모핑 함수 통합 분리
- [ ] `polygon_morphing.py` 생성
- [ ] **함수 이름 변경** (landmark 표현 제거, 옵션 2 확정):
  - 모든 `transform_landmarks_*` → `transform_points_*` (간결하고 명확)
  - `move_landmark_group` → `move_point_group`
  - `move_landmark_points` → `move_points`
  - **선택된 옵션**: 옵션 2 (`transform_points_*`) - 간결성과 명확성의 균형
- [ ] **기존 호환성 유지**:
  - 별칭 사용 안 함 (깔끔한 리팩토링)
  - 모든 사용처를 새 함수 이름으로 변경 (필수)
  - **파일 내부 구조 정의** (섹션별 구분):
    
    ```python
    """
    랜드마크 변형 및 폴리곤 모핑 모듈
    
    이 모듈은 랜드마크(얼굴 특징점)를 변형하고, 
    변형된 랜드마크를 기반으로 폴리곤(삼각형 메시)을 생성하여 
    이미지 모핑을 수행합니다.
    
    개념 정의:
    - 랜드마크(Landmark): 얼굴 특징점의 좌표 리스트 [(x, y), ...]
    - 폴리곤(Polygon): 랜드마크 포인트를 꼭짓점으로 하는 삼각형 메시 (Delaunay Triangulation)
    - 모핑(Morphing): 원본 랜드마크를 변형된 랜드마크로 변환하여 이미지를 변형하는 과정
    
    사용 흐름:
    1. 랜드마크 변형: transform_landmarks_* 함수로 랜드마크 포인트 변형
    2. 폴리곤 모핑: morph_face_by_polygons 함수로 변형된 랜드마크를 사용하여 이미지 변형
    """
    
    # ============================================================================
    # 섹션 1: 폴리곤 포인트 변형 (Polygon Points Transformation)
    # ============================================================================
    # 목적: 조정 파라미터를 받아서 폴리곤 포인트를 변형
    # 입력: 원본 폴리곤 포인트 + 조정 파라미터
    # 출력: 변형된 폴리곤 포인트 리스트
    # 
    # 중요: 
    # - 랜드마크는 참조용으로만 사용 (직접 수정하지 않음)
    # - 실제 변형 대상은 폴리곤 포인트 (랜드마크 + 경계 포인트)
    # - 함수 이름은 기존 호환성을 위해 transform_landmarks_* 유지
    #   (내부적으로는 폴리곤 포인트를 변형)
    
    def transform_points_for_eye_size(...):
        """눈 크기 조정을 포인트 변형으로 변환 (폴리곤 포인트 변형)"""
        ...
    
    def transform_points_for_nose_size(...):
        """코 크기 조정을 포인트 변형으로 변환 (폴리곤 포인트 변형)"""
        ...
    
    # ... (나머지 transform_points_* 함수들)
    
    # 참고: 기존 함수 이름은 별칭으로 제공하지 않음
    # 모든 사용처를 새 함수 이름으로 변경해야 함
    
    # ============================================================================
    # 섹션 2: 폴리곤 포인트 이동 (Polygon Points Movement)
    # ============================================================================
    # 목적: 폴리곤 포인트를 직접 이동
    # 입력: 원본 폴리곤 포인트 + 이동 파라미터
    # 출력: 이동된 폴리곤 포인트 리스트
    #
    # 중요:
    # - 랜드마크는 참조용으로만 사용
    # - 실제 이동 대상은 폴리곤 포인트
    
    def move_point_group(...):
        """포인트 그룹을 이동 (폴리곤 포인트 그룹)"""
        ...
    
    def move_points(...):
        """포인트를 이동 (폴리곤 포인트)"""
        ...
    
    # 참고: 기존 함수 이름은 별칭으로 제공하지 않음
    # 모든 사용처를 새 함수 이름으로 변경해야 함
    
    # ============================================================================
    # 섹션 3: 폴리곤 모핑 (Polygon Morphing)
    # ============================================================================
    # 목적: 변형된 랜드마크를 기반으로 Delaunay Triangulation을 수행하고 이미지 변형
    # 입력: 원본 이미지 + 원본 랜드마크 + 변형된 랜드마크
    # 출력: 변형된 이미지
    
    def _get_neighbor_points(...):
        """인접 포인트 추출 (내부 헬퍼 함수)"""
        ...
    
    def _check_triangles_flipped(...):
        """뒤집힌 삼각형 검사 (내부 헬퍼 함수)"""
        ...
    
    def morph_face_by_polygons(...):
        """
        폴리곤 포인트 기반 얼굴 변형
        
        이 함수는 폴리곤 포인트 변형의 결과를 받아서 실제 이미지 변형을 수행합니다.
        - 원본 폴리곤 포인트와 변형된 폴리곤 포인트를 받음
        - Delaunay Triangulation으로 삼각형 메시 생성
        - 각 삼각형을 변형하여 이미지 모핑 수행
        
        중요:
        - 입력 파라미터 이름은 기존 호환성을 위해 original_landmarks, transformed_landmarks 사용
        - 실제로는 폴리곤 포인트 (랜드마크 + 경계 포인트)를 처리
        - 랜드마크는 참조용으로만 사용, 직접 수정하지 않음
        """
        ...
    ```
  
  - **구조화 원칙**:
    1. 명확한 섹션 구분 (주석으로)
    2. 각 섹션의 목적과 입출력 명시
    3. 함수 이름으로 그룹화 (transform_*, move_*, morph_*)
    4. 내부 헬퍼 함수는 `_` 접두사 사용
    5. 모듈 상단에 개념 정의 및 사용 흐름 문서화
  
  - 필요한 import 추가
  - **통합 이유**: 랜드마크는 폴리곤의 꼭짓점이므로 개념적으로 밀접하게 연관됨

#### 7단계: 통합 함수 분리
- [ ] `integration.py` 생성
  - `apply_all_adjustments()` 이동
  - 필요한 import 추가

#### 8단계: __init__.py 구성
- [ ] `__init__.py` 작성
  - 모든 공개 함수 import
  - 기존 `from utils.face_morphing import *` 호환성 유지
  - 전역 변수 export (필요시)

#### 9단계: 기존 파일 수정
- [ ] `utils/face_morphing.py` 수정
  - 모든 함수를 새 모듈에서 import
  - 기존 함수 이름은 완전히 제거 (별칭 없음)

#### 10단계: 사용처 확인 및 변경 (필수)
- [ ] 모든 사용처에서 새 함수 이름으로 변경 (별칭 없이 완전 변경)
  - `gui/face_edit/morphing.py` - `transform_landmarks_*` → `transform_points_*`
  - `gui/face_edit/__init__.py` - `transform_landmarks_*` → `transform_points_*`
  - `gui/face_edit/preview.py` - `transform_landmarks_*` → `transform_points_*`
  - `gui/face_edit/polygon_drag_handler.py` - `move_landmark_*` → `move_point_*`
  - `utils/face_generation.py` - `transform_landmarks_*` → `transform_points_*`
  - `utils/face_transform.py` - `transform_landmarks_*` → `transform_points_*`
  - `utils/face_morphing.py` (integration.py) - 내부 호출 변경
  - 모든 test 파일들
- [ ] 기능 테스트
- [ ] 성능 테스트 (캐시 동작 확인)
- [ ] 모든 기존 함수 이름 제거 확인

#### 11단계: 기존 파일 제거 (선택적)
- [ ] 모든 테스트 완료 후
- [ ] `utils/face_morphing.py` 제거 (모든 함수를 새 모듈로 이동 완료 후)

## 상세 작업 내용

### 모듈별 예상 라인 수

1. **constants.py**: 약 30줄
   - 전역 변수, 선택적 import

2. **utils.py**: 약 100줄
   - 마스크 관련 유틸리티

3. **region_extraction.py**: 약 350줄
   - 영역 추출 함수 3개

4. **adjustments.py**: 약 2,000줄
   - 조정 함수 13개 (가장 큰 모듈)

5. **polygon_morphing.py**: 약 1,700줄 (통합)
   - **섹션 1: 폴리곤 포인트 변형** (약 900줄)
     - `transform_points_*` 함수 9개 (함수 이름 변경, 간결한 버전 추천)
     - 조정 파라미터를 폴리곤 포인트 변형으로 변환
     - **중요**: 랜드마크는 참조용, 실제 변형 대상은 폴리곤 포인트
     - 별칭 없이 새 함수 이름만 사용
   - **섹션 2: 폴리곤 포인트 이동** (약 200줄)
     - `move_point_*` / `move_points` 함수 2개 (함수 이름 변경)
     - 폴리곤 포인트 직접 이동
     - **중요**: 랜드마크는 참조용, 실제 이동 대상은 폴리곤 포인트
     - 별칭 없이 새 함수 이름만 사용
   - **섹션 3: 폴리곤 모핑** (약 600줄)
     - `_get_neighbor_points()` (내부 헬퍼)
     - `_check_triangles_flipped()` (내부 헬퍼)
     - `morph_face_by_polygons()` (공개 함수)
     - 변형된 랜드마크를 기반으로 이미지 모핑 수행
   - **통합으로 인한 이점**: 
     - 관련 기능이 한 곳에 모여 있어 이해하기 쉬움
     - 명확한 섹션 구분으로 내부 구조 파악 용이
     - 사용 흐름이 자연스러움 (변형 → 모핑)

6. **integration.py**: 약 300줄
   - 통합 함수 1개

7. **__init__.py**: 약 50줄
   - 공개 API 제공

**총 예상**: 약 4,530줄 (기존 4,505줄 + 주석/구조화)
**모듈 수**: 7개 (기존 계획 9개에서 2개 감소)

### 의존성 관계

```
constants.py (기반)
  ├── utils.py
  ├── region_extraction.py
  │   └── adjustments.py
  ├── polygon_morphing.py (내부 구조)
  │   ├── 섹션 1: 랜드마크 변형 (transform_landmarks_*)
  │   ├── 섹션 2: 랜드마크 이동 (move_landmark_*)
  │   └── 섹션 3: 폴리곤 모핑 (morph_face_by_polygons)
  └── integration.py (모든 모듈 사용)
```

**변경 사항**: 
- `landmark_transform.py`, `polygon_morphing.py`, `landmark_movement.py` → `polygon_morphing.py`로 통합
- 의존성 구조가 더 단순해짐
- 내부 섹션 구분으로 구조 명확화

### 개념 정의 및 사용 흐름

#### 개념 정의 (명확화 필요)

**현재 문제점**:
- 랜드마크 포인트와 폴리곤 포인트의 관계가 모호함
- 랜드마크 포인트 개수와 폴리곤 포인트 개수가 다를 수 있음
- 폴리곤 기준으로 수정하고 싶지만 랜드마크는 따로 고치지 않으려는 의도

**명확한 정의**:

1. **랜드마크(Landmark)**: 
   - MediaPipe에서 감지된 얼굴 특징점 좌표 리스트 `[(x, y), ...]`
   - 일반적으로 468개 포인트 (MediaPipe Face Mesh)
   - **역할**: 참조용, 폴리곤 생성의 초기 기준점
   - **변경**: 랜드마크는 직접 수정하지 않음 (참조용으로만 사용)

2. **폴리곤 포인트(Polygon Points)**:
   - 실제 모핑에 사용되는 포인트 좌표 리스트 `[(x, y), ...]`
   - 랜드마크 포인트 + 경계 포인트(4개) + (선택적으로 추가 포인트)
   - **역할**: Delaunay Triangulation의 입력, 실제 모핑 수행
   - **변경**: 폴리곤 포인트를 직접 수정하여 모핑 수행

3. **폴리곤(Polygon)**:
   - 폴리곤 포인트를 꼭짓점으로 하는 삼각형 메시 (Delaunay Triangulation)
   - 삼각형들의 집합으로 구성
   - **역할**: 이미지 모핑의 기하학적 구조

4. **모핑(Morphing)**:
   - 원본 폴리곤 포인트 → 변형된 폴리곤 포인트로 변환하여 이미지 변형
   - 랜드마크는 참조용으로만 사용

#### 사용 흐름 (개선된 버전)

```
1. 랜드마크 감지 (참조용)
   detect_face_landmarks(image)
   → landmarks (468개 포인트, 참조용)

2. 폴리곤 포인트 생성 (랜드마크 기반)
   landmarks + boundary_points
   → polygon_points (랜드마크 + 경계 포인트)

3. 폴리곤 포인트 변형 (섹션 1, 2)
   transform_points_for_eye_size(polygon_points, ...)
   또는
   move_points(polygon_points, ...)
   → transformed_polygon_points

4. 폴리곤 모핑 (섹션 3)
   morph_face_by_polygons(image, original_polygon_points, transformed_polygon_points)
   → 변형된 이미지 생성
```

#### 아키텍처 개선 방향

**현재 문제**:
- 함수 이름이 `transform_landmarks_*`로 되어 있어 랜드마크를 직접 수정하는 것처럼 보임
- 실제로는 폴리곤 포인트를 변형해야 함
- 랜드마크와 폴리곤 포인트의 구분이 명확하지 않음

**개선 방안 검토**:

### 옵션 비교

#### 옵션 1: `transform_polygon_points_*` (명시적)
- **예시**: `transform_polygon_points_for_eye_size`
- **장점**: 무엇을 변형하는지 명확
- **단점**: 함수 이름이 김 (35자), 타이핑 번거로움

#### 옵션 2: `transform_points_*` (간결, 추천)
- **예시**: `transform_points_for_eye_size`
- **장점**: 
  - 간결함 (28자)
  - 모듈 이름(`polygon_morphing.py`)과 함께 사용하면 충분히 명확
  - 타이핑이 쉬움
- **단점**: 모듈 컨텍스트 없이는 약간 모호할 수 있음 (하지만 모듈 내부에서는 문제 없음)

#### 옵션 3: `transform_mesh_points_*` (기술적)
- **예시**: `transform_mesh_points_for_eye_size`
- **장점**: "mesh"가 Delaunay Triangulation 결과물을 명확히 표현
- **단점**: 기술적 용어라 덜 직관적

#### 옵션 4: `transform_for_*` (최소 변경)
- **예시**: `transform_for_eye_size`
- **장점**: 가장 간결 (22자)
- **단점**: 무엇을 변형하는지 불명확 (하지만 모듈 이름으로 보완 가능)

### 선택: 옵션 2 (`transform_points_*`) - 확정

**선택 이유**:
1. 간결성과 명확성의 균형
2. 모듈 컨텍스트에서 충분히 명확
3. `morph_face_by_polygons`와 일관성 유지
4. 실용적 (타이핑 용이)

**최종 확정된 함수 이름**:
- `transform_landmarks_for_eye_size` → `transform_points_for_eye_size`
- `transform_landmarks_for_nose_size` → `transform_points_for_nose_size`
- `transform_landmarks_for_jaw` → `transform_points_for_jaw`
- `transform_landmarks_for_face_size` → `transform_points_for_face_size`
- `transform_landmarks_for_mouth_size` → `transform_points_for_mouth_size`
- `transform_landmarks_for_eye_position` → `transform_points_for_eye_position`
- `transform_landmarks_for_lip_shape` → `transform_points_for_lip_shape`
- `transform_landmarks_for_lip_width` → `transform_points_for_lip_width`
- `transform_landmarks_for_lip_vertical_move` → `transform_points_for_lip_vertical_move`
- `move_landmark_group` → `move_point_group`
- `move_landmark_points` → `move_points`

**대안 제시**:
- 더 명시적으로 하려면: `transform_polygon_points_*` (옵션 1)
- 더 간결하게 하려면: `transform_for_*` (옵션 4)

2. **변수 이름 명확화**:
   - 함수 파라미터: `landmarks` → `points` 또는 `polygon_points` (선택)
   - 참조용: `reference_landmarks` 또는 `landmarks` (참조용 랜드마크, 선택적)

3. **문서화 강화**:
   - 각 함수의 docstring에 "폴리곤 포인트 변형" 명시
   - 랜드마크는 참조용으로만 사용됨을 명확히
   - 모듈 상단에 개념 정의 문서화

## 주의사항

### 1. 호환성 유지
- 기존 `import utils.face_morphing as face_morphing` 형식 유지
- 모든 공개 함수가 동일하게 동작해야 함
- **함수 이름 변경: 별칭 없이 완전 변경** (깔끔한 리팩토링)
- 모든 사용처를 새 함수 이름으로 변경 (필수)
- 전역 변수 접근 방식 유지 (필요시)

### 2. 순환 참조 방지
- 모듈 간 import 순서 주의
- `constants.py`는 다른 모듈을 import하지 않음
- `__init__.py`에서만 모든 모듈 import

### 3. 테스트
- 각 모듈 분리 후 즉시 테스트
- 기존 기능과 동일하게 동작하는지 확인
- 성능 저하 없음 확인

### 4. 점진적 마이그레이션
- 한 번에 모든 것을 분리하지 않고 단계별로 진행
- 각 단계마다 테스트 및 검증

## 예상 효과

### 즉시 효과
- 파일 크기 감소: 4,505줄 → 평균 500줄 이하 (모듈당)
- 가독성 향상: 기능별로 명확히 분리
- 탐색 용이: 원하는 기능을 빠르게 찾을 수 있음

### 장기 효과
- 유지보수성 향상: 특정 기능 수정 시 해당 모듈만 수정
- 협업 효율: 여러 개발자가 동시에 작업 가능
- 테스트 용이: 모듈별 독립 테스트 가능
- 재사용성 향상: 필요한 모듈만 import 가능

## 리스크 및 대응

### 리스크
1. **순환 참조 발생 가능성**
   - 대응: 명확한 의존성 구조 설계, `__init__.py`에서만 통합

2. **기존 코드 호환성 문제**
   - 대응: `__init__.py`에서 모든 공개 API 제공, 기존 import 경로 유지

3. **성능 저하 가능성**
   - 대응: import 오버헤드 최소화, 캐시 동작 확인

4. **테스트 누락**
   - 대응: 각 단계마다 테스트, 기존 테스트 코드 활용

## 검토 사항

- [x] 모듈 분리 구조 검토 (완료)
- [x] 작업 단계 검토 (완료)
- [x] 호환성 유지 방안 검토 (완료)
- [x] 함수 이름 변경 방식 검토 (옵션 2 확정)
- [ ] 테스트 계획 검토

## 최종 확정 사항

### 함수 이름 변경 (옵션 2 확정)
- `transform_landmarks_for_eye_size` → `transform_points_for_eye_size`
- `transform_landmarks_for_nose_size` → `transform_points_for_nose_size`
- `transform_landmarks_for_jaw` → `transform_points_for_jaw`
- `transform_landmarks_for_face_size` → `transform_points_for_face_size`
- `transform_landmarks_for_mouth_size` → `transform_points_for_mouth_size`
- `transform_landmarks_for_eye_position` → `transform_points_for_eye_position`
- `transform_landmarks_for_lip_shape` → `transform_points_for_lip_shape`
- `transform_landmarks_for_lip_width` → `transform_points_for_lip_width`
- `transform_landmarks_for_lip_vertical_move` → `transform_points_for_lip_vertical_move`
- `move_landmark_group` → `move_point_group`
- `move_landmark_points` → `move_points`

### 기존 호환성 유지
- **별칭 사용 안 함**: 깔끔한 리팩토링을 위해 기존 함수 이름 완전 제거
- 모든 사용처를 새 함수 이름으로 변경 (필수)
- 기존 함수 이름은 완전히 제거

## 향후 추가 리팩토링 계획 (2차 리팩토링)

### 현재 계획의 한계
현재 1차 리팩토링은 기능별 모듈 분리에 집중하지만, 여전히 다음 문제가 남을 수 있습니다:

1. **`adjustments.py`가 여전히 큼** (약 2,000줄)
   - 13개의 조정 함수가 하나의 파일에 모여있음
   - 각 함수가 복잡하고 길 수 있음

2. **함수 기반 구조의 한계**
   - 관련 함수들이 분산되어 있음
   - 상태 관리가 어려움

3. **재사용성 제한**
   - 특정 기능만 필요한 경우에도 전체 모듈을 import해야 함

### 2차 리팩토링 방향 (향후 검토)

#### 옵션 1: 기능별 세부 모듈 분리
```
utils/face_morphing/
  adjustments/
    __init__.py
    eye.py          # 눈 관련 조정 (adjust_eye_*)
    nose.py         # 코 관련 조정
    mouth.py        # 입 관련 조정
    face.py         # 얼굴 전체 조정
    lip.py          # 입술 관련 조정
```

#### 옵션 2: 클래스 기반 구조
```
utils/face_morphing/
  adjustments/
    __init__.py
    base.py         # BaseAdjustment 클래스
    eye_adjuster.py # EyeAdjuster 클래스
    nose_adjuster.py
    mouth_adjuster.py
    ...
```

#### 옵션 3: 전략 패턴 적용
- 각 조정 기능을 전략 객체로 분리
- 공통 인터페이스 제공
- 플러그인 방식으로 확장 가능

### 2차 리팩토링 시점
- 1차 리팩토링 완료 후
- `adjustments.py` 사용 빈도 및 복잡도 분석 후
- 실제 유지보수 경험을 바탕으로 결정

### 권장 사항
1. **1차 리팩토링 우선 진행**: 현재 계획대로 모듈 분리
2. **사용 패턴 관찰**: 실제 사용 경험을 바탕으로 추가 개선점 파악
3. **점진적 개선**: 필요시 2차 리팩토링 진행

## 참고 사항

- 기존 `gui/face_extract` 리팩토링 사례 참고 (task260113_1645.md)
- Mixin 패턴 사용 사례 참고
- 점진적 마이그레이션 전략 채택
- 완벽한 리팩토링보다는 실용적인 개선에 집중
