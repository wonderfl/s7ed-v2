# 작업계획서: 눈동자 중심점 드래그 버그 수정

## 1. 작업 목표
눈동자 중심점을 드래그해도 눈동자는 움직이지 않고 머리만 움직이는 버그를 수정합니다.

## 2. 문제 분석
눈동자 중심점을 드래그해도 눈동자는 움직이지 않고 머리만 움직이는 원인:

1. **`on_iris_center_drag_start`에서 `last_selected_landmark_index` 미설정**
   - `on_iris_center_drag_start`에서 `last_selected_landmark_index`를 'left' 또는 'right'로 설정하지 않음
   - `apply_polygon_drag_final`에서 `is_iris_center_only`가 False로 판단됨
   - 결과적으로 `custom_landmarks_for_morph`가 원본으로 설정되지 않음

2. **`custom_landmarks`가 470개가 아닌 경우 처리 누락**
   - `custom_landmarks`가 468개인 경우 중앙 포인트가 포함되지 않음
   - `on_iris_center_drag`에서 중앙 포인트를 추가하지만, `apply_polygon_drag_final`에서 이를 제대로 처리하지 못함

3. **Delaunay Triangulation 특성**
   - 중앙 포인트만 변경해도 주변 삼각형이 변형되어 머리 전체가 움직일 수 있음
   - 하지만 현재는 눈동자가 움직이지 않고 머리만 움직이는 것이 문제

## 3. 작업 계획

### 3.1. `on_iris_center_drag_start` 수정
- `on_iris_center_drag_start` 함수에서 `self.last_selected_landmark_index = iris_side` 설정
- 눈동자 중심점 드래그임을 명확히 표시

### 3.2. `apply_polygon_drag_final` 수정
- `custom_landmarks_for_morph`가 468개인 경우에도 원본으로 설정
- 중앙 포인트만 변경한 경우 다른 랜드마크는 원본과 동일하게 유지
- `custom_landmarks_for_morph`와 `original_landmarks_for_morph`가 동일한지 확인

### 3.3. 디버깅 로그 추가
- `custom_landmarks_for_morph`와 `original_landmarks_for_morph` 비교 로그 추가
- 중앙 포인트 좌표 확인 로그 추가
- `morph_face_by_polygons` 호출 시 전달되는 파라미터 확인

## 4. 작업 순서
1. [x] `gui/face_edit/polygon_drag_handler.py` 수정:
   - [x] `on_iris_center_drag_start` 함수에서 `self.last_selected_landmark_index = iris_side` 설정
   - [x] `apply_polygon_drag_final`에서 `custom_landmarks_for_morph`를 원본으로 설정하는 로직 수정
   - [x] 디버깅 로그 추가
2. [ ] 테스트 및 검증:
   - [ ] 눈동자 중심점 드래그 시 눈동자만 움직이는지 확인
   - [ ] 머리가 움직이지 않는지 확인
