# 작업계획서: 중앙 포인트 계산 구조 단순화

## 작업 목표
`_ensure_iris_centers_in_landmarks` 함수를 제거하고, 중앙 포인트를 `custom_landmarks`에 저장하지 않고 필요할 때마다 `original_landmarks`에서 계산하도록 단순화

## 문제점
1. `_ensure_iris_centers_in_landmarks`가 여러 곳에서 호출되어 복잡함
2. `custom_landmarks`를 직접 수정하여 안정성 문제 발생
3. 중앙 포인트 인덱스 관리가 복잡함
4. 사이즈 초기화 시 위치가 바뀌는 문제 발생

## 해결 방법
1. `_ensure_iris_centers_in_landmarks` 함수 제거
2. 중앙 포인트 계산 헬퍼 함수 추가: `_calculate_iris_center(landmarks, iris_indices, img_width, img_height)`
3. `custom_landmarks`는 수정하지 않고, 필요할 때마다 `original_landmarks`에서 계산
4. 드래그 시에는 중앙 포인트 좌표만 별도로 저장하여 업데이트

## 작업 단계

### 1단계: 중앙 포인트 계산 헬퍼 함수 추가
- [x] `polygon_drag_handler.py`에 `_calculate_iris_center` 함수 추가
- [x] `polygon_drag_handler.py`에 `_get_iris_indices` 함수 추가
- [x] MediaPipe LEFT_IRIS, RIGHT_IRIS 인덱스 추출 로직 포함
- [x] 좌표 계산 로직 포함

### 2단계: 중앙 포인트 저장 방식 변경
- [x] `__init__.py`에 `_left_iris_center_coord`, `_right_iris_center_coord` 추가
- [x] `_left_iris_center_index`, `_right_iris_center_index` 참조를 좌표 기반으로 변경
- [x] 드래그 시 좌표만 업데이트

### 3단계: `_ensure_iris_centers_in_landmarks` 호출 제거
- [x] `polygon_renderer.py`에서 모든 호출 제거
- [x] `morphing.py`에서 모든 호출 제거
- [x] `__init__.py`에서 모든 호출 제거
- [x] 중앙 포인트 계산 로직을 직접 호출로 변경

### 4단계: `_ensure_iris_centers_in_landmarks` 함수 제거
- [x] `polygon_drag_handler.py`에서 함수 정의 제거
- [x] 관련 로직 정리

### 5단계: 드래그 핸들러 수정
- [x] `on_iris_center_drag_start`에서 좌표 저장 (인덱스 대신 'left'/'right' 사용)
- [x] `on_iris_center_drag`에서 좌표 업데이트
- [x] `on_iris_center_drag_end`에서 최종 적용
- [x] `polygon_renderer.py`에서 드래그 이벤트 바인딩 수정

### 6단계: 테스트 및 검증
- [ ] 중앙 포인트가 올바르게 표시되는지 확인
- [ ] 드래그가 정상 작동하는지 확인
- [ ] 사이즈 초기화 시 위치가 바뀌지 않는지 확인

## 예상 효과
1. 코드 단순화: 복잡한 함수 제거
2. 안정성 향상: `custom_landmarks`를 수정하지 않음
3. 유지보수성 향상: 중앙 포인트 계산 로직이 한 곳에 집중
4. 버그 해결: 사이즈 초기화 시 위치가 바뀌는 문제 해결

## 주의사항
- LEFT/RIGHT 매핑 원칙 유지 (절대 변경하지 않음)
- MediaPipe 정의 그대로 사용
- `original_landmarks`를 기준으로 계산
