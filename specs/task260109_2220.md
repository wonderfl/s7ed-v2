# 작업 계획서: 옷 기준 비교 기능 추가

**작업 일시**: 2026-01-09 22:20  
**작업 목표**: 비슷한 얼굴 찾기 기능에 옷 영역 비교 기능 추가

## 작업 배경
- 다른 얼굴이어도 같은 옷을 입고 있는 경우가 많음
- 옷을 기준으로 비교하면 같은 캐릭터를 더 정확하게 찾을 수 있음
- 얼굴 특징과 옷 특징을 결합하여 비교 정확도 향상

## 작업 순서

### 1단계: 옷 영역 추출 함수 구현
- [x] `utils/face_landmarks.py`에 옷 영역 추출 함수 추가
  - 함수명: `extract_clothing_region(image, landmarks=None)`
  - 얼굴 랜드마크를 사용하여 얼굴 영역 하단 추정
  - 얼굴 하단(입 아래)부터 이미지 하단까지를 옷 영역으로 추정
  - 반환: 옷 영역 이미지 (PIL.Image)

### 2단계: 옷 특징 벡터 추출 함수 구현
- [x] `utils/face_landmarks.py`에 옷 특징 벡터 추출 함수 추가
  - 함수명: `extract_clothing_features_vector(image, landmarks=None)`
  - 옷 영역 추출 후 색상 히스토그램 계산
  - RGB 각 채널별 히스토그램 (256 bins)
  - 주요 색상 추출 (가장 많이 나타나는 색상들)
  - 평균 색상, 색상 분산 등 통계값
  - 반환: 옷 특징 벡터 (numpy array)

### 3단계: 종합 특징 벡터 및 유사도 계산 수정
- [x] `utils/face_landmarks.py`에 종합 특징 벡터 및 유사도 계산 함수 추가
  - 얼굴 특징과 옷 특징을 결합한 종합 특징 벡터 반환
  - 또는 별도 함수로 분리: `extract_combined_features_vector()`
- [ ] `calculate_face_similarity()` 함수 수정
  - 얼굴 특징과 옷 특징을 각각 비교
  - 가중치 적용: 얼굴 70%, 옷 30% (또는 사용자 설정 가능)
  - 종합 유사도 계산

### 4단계: UI에 옷 비교 옵션 추가
- [x] `gui/_face_similar.py`에 옵션 추가
  - "옷 포함 비교" 체크박스 추가
  - 옵션에 따라 얼굴만 비교 또는 얼굴+옷 비교 선택 가능

## 구현 세부사항

### 옷 영역 추출 방법
1. 얼굴 랜드마크에서 입 위치 확인
2. 입 위치 아래부터 이미지 하단까지를 옷 영역으로 추정
3. 얼굴 너비를 기준으로 좌우 경계 설정 (얼굴 중심 기준)
4. 옷 영역 크롭 및 리사이즈 (일정한 크기로 정규화)

### 옷 특징 벡터 구성
1. RGB 각 채널 히스토그램 (256 bins) → 768차원
2. 주요 색상 상위 10개 (RGB 값) → 30차원
3. 평균 색상 (R, G, B) → 3차원
4. 색상 분산 (R, G, B) → 3차원
5. 총 804차원 (또는 더 간소화 가능)

### 유사도 계산
- 얼굴 유사도: 기존 방식
- 옷 유사도: 히스토그램 비교 (Bhattacharyya 거리 또는 히스토그램 교차)
- 종합 유사도 = 얼굴_유사도 * 0.7 + 옷_유사도 * 0.3

### 폴백 처리
- 얼굴을 찾을 수 없으면 옷 영역 추출 불가
- 옷 영역이 너무 작으면 (이미지 하단이 얼굴에 가까우면) 옷 특징 추출 생략
