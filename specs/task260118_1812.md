# 추가 리팩토링 작업계획서

## 작업 개요
큰 파일들 중 가장 큰 두 파일을 추가로 리팩토링하여 코드 가독성과 유지보수성 향상

## 대상 파일 및 규모

### 1단계: drawing.py의 _draw_landmark_polygons 메서드 분리
- **파일**: `gui/face_edit/polygon_renderer/drawing.py`
- **현재 상태**: 
  - 전체 파일: 2,451줄
  - `_draw_landmark_polygons`: 약 2,244줄 (18-2263)
  - `_fill_polygon_area`: 약 187줄 (2264-2451)
- **문제점**: 단일 메서드가 너무 크고, 탭별 로직이 혼재되어 있음

### 2단계: logic.py의 apply_editing 메서드 분리
- **파일**: `gui/face_edit/morphing/logic.py`
- **현재 상태**:
  - 전체 파일: 1,263줄
  - `apply_editing`: 약 1,264줄 (922-1186)
- **문제점**: 단일 메서드가 너무 크고, 처리 단계별 로직이 혼재되어 있음

## 작업 계획

### 1단계: drawing.py의 _draw_landmark_polygons 탭별 분리

#### 목표 구조
```
gui/face_edit/polygon_renderer/
├── drawing.py (메인 메서드 + 공통 로직)
└── tab_drawers.py (탭별 그리기 메서드)
```

#### 분리할 메서드
1. `_draw_all_tab_polygons` - 전체 탭 (약 329-1289줄)
2. `_draw_eye_tab_polygons` - 눈 탭 (약 1370-1618줄)
3. `_draw_nose_tab_polygons` - 코 탭 (약 1619-1726줄)
4. `_draw_mouth_tab_polygons` - 입 탭 (약 1727-1839줄)
5. `_draw_eyebrow_tab_polygons` - 눈썹 탭 (약 1840-2005줄)
6. `_draw_jaw_tab_polygons` - 턱선 탭 (약 2006-2165줄)
7. `_draw_contour_tab_polygons` - 윤곽 탭 (약 2166-2263줄)

#### 작업 순서
1. `tab_drawers.py` 파일 생성
2. 각 탭별 메서드 추출 (Python 스크립트 사용)
3. `drawing.py`의 `_draw_landmark_polygons` 메서드를 탭별 메서드 호출로 변경
4. import 경로 확인 및 수정
5. 테스트 및 검증

### 2단계: logic.py의 apply_editing 단계별 분리

#### 목표 구조
```
gui/face_edit/morphing/
├── logic.py (메인 메서드 + 통합 로직)
└── editing_steps.py (단계별 처리 메서드)
```

#### 분리할 메서드
1. `_prepare_editing_parameters` - 파라미터 준비 (약 934-1013줄)
2. `_apply_morphing_step` - 얼굴 특징 보정 적용 (약 974-1013줄)
3. `_apply_style_transfer_step` - 스타일 전송 적용 (약 1015-1030줄)
4. `_apply_age_transform_step` - 나이 변환 적용 (약 1032-1035줄)
5. `_update_landmarks_after_editing` - 랜드마크 업데이트 (약 1042-1186줄)

#### 작업 순서
1. `editing_steps.py` 파일 생성
2. 각 단계별 메서드 추출 (Python 스크립트 사용)
3. `logic.py`의 `apply_editing` 메서드를 단계별 메서드 호출로 변경
4. import 경로 확인 및 수정
5. 테스트 및 검증

## 작업 원칙

1. **기능 보존**: 리팩토링 후에도 동일한 기능 유지
2. **점진적 진행**: 각 단계 완료 후 검증
3. **에러 처리**: 모든 예외는 로그 출력 (pass 금지)
4. **의존성 관리**: import 경로 정확히 수정
5. **백업**: 원본 파일은 `.bak` 확장자로 백업

## 주의사항

1. **탭별 로직 분리 시**: 공통 헬퍼 함수(`draw_polygon_mesh`, `bind_polygon_click_events` 등)는 적절히 공유
2. **단계별 로직 분리 시**: 변수 스코프와 상태 관리 주의
3. **테스트**: 각 단계 완료 후 import 테스트 및 linter 확인
4. **하위 호환성**: 기존 코드와의 호환성 유지

## 예상 소요 시간

- 1단계: 약 1-2시간
- 2단계: 약 1-2시간
- 총 예상 시간: 약 2-4시간

## 작업 체크리스트

### 1단계: drawing.py 리팩토링
- [x] `tab_drawers.py` 파일 생성
- [x] 탭별 메서드 추출 (전체, 눈, 눈썹, 코, 입, 턱선, 윤곽)
- [x] `drawing.py`의 `_draw_landmark_polygons` 메서드 리팩토링
- [x] import 경로 수정
- [x] 테스트 및 검증
- [x] linter 오류 확인 및 수정

**완료**: drawing.py 2,451줄 -> 571줄로 감소, tab_drawers.py에 탭별 메서드 분리 완료
- TabDrawersMixin import 성공
- DrawingMixin import 성공
- 모든 들여쓰기 오류 수정 완료

### 2단계: logic.py 리팩토링
- [x] `editing_steps.py` 파일 생성
- [x] 단계별 메서드 추출 (파라미터 준비, 특징 보정, 스타일 전송, 나이 변환, 랜드마크 업데이트)
- [x] `logic.py`의 `apply_editing` 메서드 리팩토링
- [x] import 경로 수정
- [x] 테스트 및 검증
- [x] linter 오류 확인 및 수정

**완료**: logic.py의 apply_editing 메서드를 단계별 메서드 호출로 리팩토링 완료
- EditingStepsMixin import 성공
- LogicMixin import 성공
- 모든 구문 오류 수정 완료

## 완료 기준

1. 모든 메서드가 정상적으로 import됨
2. linter 오류 없음
3. 기능 테스트 통과
4. 파일 크기가 적절한 수준으로 감소 (각 메서드 500줄 이하)
