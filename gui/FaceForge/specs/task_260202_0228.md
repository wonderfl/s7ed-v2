# 미리보기 창에 Bbox 사이즈 출력 기능 작업계획서

**작업일**: 2026-02-02 02:28  
**담당자**: Cascade  
**목표**: 미리보기 창에 얼굴 영역 Bbox(경계 상자) 사이즈 정보를 실시간으로 표시

## 작업 목표
MediaPipe Face Mesh로 감지된 얼굴 영역의 경계 상자(Bbox) 크기를 미리보기 창에 실시간으로 표시하여 사용자가 얼굴 영역의 정확한 크기를 확인할 수 있도록 구현

## 작업 범위
- **수정 파일**: `gui/preview.py`, `utils/landmarks.py`
- **신규 기능**: Bbox 크기 계산 및 표시
- **UI 요소**: 미리보기 창에 사이즈 정보 표시 레이블

## 단계별 작업 계획

### 단계 1: Bbox 계산 함수 구현
- [ ] `utils/landmarks.py`에 Bbox 계산 함수 추가
- [ ] 랜드마크 포인트에서 최소/최대 x,y 좌표 추출
- [ ] Bbox 너비(width)와 높이(height) 계산
- [ ] 픽셀 단위 크기 반환 기능 구현
- [ ] 유효성 검사 (랜드마크가 없는 경우 처리)

### 단계 2: PreviewManagerMixin에 Bbox 표시 기능 추가
- [ ] `gui/preview.py`에 Bbox 정보 표시 UI 요소 추가
- [ ] Bbox 크기 표시 레이블/텍스트 위젯 생성
- [ ] 미리보기 창 레이아웃에 Bbox 정보 영역 추가
- [ ] Bbox 정보 업데이트 메서드 구현 (`_update_bbox_info`)

### 단계 3: 랜드마크 감지와 Bbox 연동
- [ ] 랜드마크 감지 성공 시 Bbox 계산 트리거
- [ ] 이미지 로드/변경 시 Bbox 정보 업데이트
- [ ] 확대/축소 시 Bbox 크기 재계산 및 표시
- [ ] 드래그 시 Bbox 정보 동기화

### 단계 4: 좌표 변환 및 단위 처리
- [ ] 랜드마크 좌표를 이미지 픽셀 좌표로 변환
- [ ] 확대/축소 비율에 따른 실제 표시 크기 계산
- [ ] 소수점 처리 및 반올림 (정수 픽셀 단위 표시)
- [ ] 단위 표시 (px) 추가

### 단계 5: UI 표시 형식 구현
- [ ] Bbox 정보 표시 형식 지정 (예: "Bbox: 150x200 px")
- [ ] 폰트, 색상, 위치 디자인
- [ ] 미리보기 창과의 시각적 조화
- [ ] 정보가 없는 경우 메시지 처리 ("No face detected")

### 단계 6: 테스트 및 디버깅
- [ ] 다양한 얼굴 크기 이미지로 Bbox 계산 테스트
- [ ] 확대/축소 시 크기 변화 정확성 테스트
- [ ] 여러 이미지 전환 시 정보 업데이트 테스트
- [ ] 얼굴 없는 이미지 처리 테스트
- [ ] 성능 최적화 (불필요한 재계산 방지)

## 기술 구현 상세

### Bbox 계산 알고리즘
```python
def calculate_bbox_size(landmarks):
    """
    랜드마크 포인트에서 Bbox 크기 계산
    Args:
        landmarks: MediaPipe 랜드마크 포인트 리스트
    Returns:
        dict: {'width': int, 'height': int, 'x': int, 'y': int}
    """
    if not landmarks:
        return None
    
    x_coords = [landmark.x for landmark in landmarks]
    y_coords = [landmark.y for landmark in landmarks]
    
    min_x, max_x = min(x_coords), max(x_coords)
    min_y, max_y = min(y_coords), max(y_coords)
    
    width = max_x - min_x
    height = max_y - min_y
    
    return {
        'width': int(width * image_width),
        'height': int(height * image_height),
        'x': int(min_x * image_width),
        'y': int(min_y * image_height)
    }
```

### 좌표 변환 공식
```python
# 이미지 좌표 → 확대/축소된 표시 좌표
display_width = bbox_width * scale_factor
display_height = bbox_height * scale_factor
```

### UI 표시 형식
```
기본 형식: "Bbox: {width}x{height} px"
확대/축소 시: "Bbox: {display_width}x{display_height} px (실제: {width}x{height} px)"
얼굴 없음: "No face detected"
```

## 테스트 계획

### 기능 테스트
1. **Bbox 계산**: 다양한 얼굴 크기에서 정확한 width/height 계산 확인
2. **실시간 업데이트**: 이미지 로드/변경 시 정보 즉시 업데이트 확인
3. **확대/축소**: 스케일 변경 시 표시 크기 정확히 반영 확인
4. **UI 표시**: 정보가 미리보기 창에 명확하게 표시되는지 확인

### 엣지 케이스 테스트
- 얼굴이 없는 이미지 처리
- 랜드마크 감지 부분적 성공 시 처리
- 극단적으로 크거나 작은 얼굴 처리
- 이미지 회전 시 Bbox 계산 정확성

## 완료 조건
- [ ] 랜드마크 감지 시 Bbox 크기 정확히 계산
- [ ] 미리보기 창에 실시간 Bbox 정보 표시
- [ ] 확대/축소 시 크기 정보 정확히 업데이트
- [ ] 얼굴 없는 경우 적절한 메시지 표시
- [ ] UI가 사용자 친화적이고 가독성 좋음

## 리스크 및 대책
- **성능 문제**: Bbox 계산을 캐싱하여 불필요한 재계산 방지
- **좌표 정확성**: 다양한 이미지 크기와 스케일에서 테스트
- **UI 혼잡**: 정보 표시 위치가 미리보기를 가리지 않도록 최적화

---

**체크리스트**: 각 단계 완료 시 [x] 표시  
**승인자**: 사용자  
**완료일**: 예정 2026-02-02 03:00
